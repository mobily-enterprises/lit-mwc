define(["./lit-element-34339bae","./StyleableMixin-9aebdd05","./ThemeableMixin-c1113bda","./NativeReflectorMixin-ee6c4eac","./nn-form"],function(a,b,c,d,e){'use strict';function f(){var b=a._taggedTemplateLiteral(["\n      ","\n      <form id=\"native\">\n        <slot></slot>\n      </form>\n    "]);return f=function(){return b},b}/* globals customElements CustomEvent */var g=/*#__PURE__*/function(b){function c(){var b;return a._classCallCheck(this,c),b=a._possibleConstructorReturn(this,a._getPrototypeOf(c).call(this)),b.validateOnLoad=!1,b.validateOnRender=!1,b.fetchingElement=null,b.submitCheckboxesAsNative=!1,b._boundRealtimeSubmitter=b._realTimeSubmitter.bind(a._assertThisInitialized(b)),b.inFlight=!1,b.attemptedFlight=!1,b.inFlightMap=new WeakMap,b.attemptedFlightMap=new WeakMap,b}return a._inherits(c,b),a._createClass(c,[{key:"reflectProperties",get:function(){// The `submit` and `elements` properties have been redefined
return a._get(a._getPrototypeOf(c.prototype),"reflectProperties",this).filter(function(a){return"submit"!==a})}}],[{key:"properties",get:function(){return{fetchingElement:{type:String,attribute:"fetching-element"},recordId:{type:String,attribute:"record-id"},setFormAfterSubmit:{type:Boolean,attribute:"set-form-after-submit"},resetFormAfterSubmit:{type:Boolean,attribute:"reset-form-after-submit"},validateOnLoad:{type:Boolean,attribute:"validate-on-load"},validateOnRender:{type:Boolean,attribute:"validate-on-render"},submitCheckboxesAsNative:{type:Boolean,attribute:"submit-checkboxes-as-native"},noAutoload:{type:Boolean,attribute:"no-autoload"},// This will allow users to redefine methods declaratively
createSubmitObject:Function,presubmit:Function,response:Function,setFormElementValues:Function,extrapolateErrors:Function}}}]),a._createClass(c,[{key:"_allChildrenCompleted",value:function(){var b=a._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(){var b,c,d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:b=!0,c=!1,d=void 0,a.prev=3,e=this.elements[Symbol.iterator]();case 5:if(b=(f=e.next()).done){a.next=13;break}if(g=f.value,"undefined"==typeof g.updateComplete){a.next=10;break}return a.next=10,g.updateComplete;case 10:b=!0,a.next=5;break;case 13:a.next=19;break;case 15:a.prev=15,a.t0=a["catch"](3),c=!0,d=a.t0;case 19:a.prev=19,a.prev=20,b||null==e["return"]||e["return"]();case 22:if(a.prev=22,!c){a.next=25;break}throw d;case 25:return a.finish(22);case 26:return a.finish(19);case 27:case"end":return a.stop();}},a,this,[[3,15,19,27],[20,,22,26]])}));return function(){return b.apply(this,arguments)}}()},{key:"_realTimeSubmitter",value:function(a){this.submit(a.target)}},{key:"connectedCallback",value:function(){var b=this;a._get(a._getPrototypeOf(c.prototype),"connectedCallback",this).call(this),this._allChildrenCompleted().then(function(){var a=!0,c=!1,d=void 0;try{for(var e,f=b.elements[Symbol.iterator]();!(a=(e=f.next()).done);a=!0){var g=e.value,h=null!==g.getAttribute("real-time"),i=g.getAttribute("real-time-event")||"input";!h||!i||b.addEventListener(i,b._boundRealtimeSubmitter)}}catch(a){c=!0,d=a}finally{try{a||null==f["return"]||f["return"]()}finally{if(c)throw d}}})}},{key:"disconnectedCallback",value:function(){a._get(a._getPrototypeOf(c.prototype),"disconnectedCallback",this).call(this);var b=!0,d=!1,e=void 0;try{for(var f,g=this.elements[Symbol.iterator]();!(b=(f=g.next()).done);b=!0){var h=f.value,i=h.getAttribute("real-time");if(null!==i){var j=h.getAttribute("real-time-event");j&&this.removeEventListener(j,this._boundRealtimeSubmitter)}}}catch(a){d=!0,e=a}finally{try{b||null==g["return"]||g["return"]()}finally{if(d)throw e}}}},{key:"firstUpdated",value:function(){var b=a._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(a._get(a._getPrototypeOf(c.prototype),"firstUpdated",this).call(this),!this.validateOnRender){b.next=5;break}return b.next=4,this._allChildrenCompleted();case 4:this.reportValidity();case 5:case"end":return b.stop();}},b,this)}));return function(){return b.apply(this,arguments)}}()},{key:"setFormElementValues",value:function(a){for(var b in a)this.setFormElementValue(b,a[b])}},{key:"setRecordObject",value:function(b){b=a._objectSpread2({},b);var c={},d=!0,e=!1,f=void 0;try{for(var g,h,i=this.elements[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)h=g.value,c[h.name]=h}catch(a){e=!0,f=a}finally{try{d||null==i["return"]||i["return"]()}finally{if(e)throw f}}for(var j,l=0,m=Object.keys(c);l<m.length;l++)j=m[l],b[j]=this.getFormElementValue(j);return b}},{key:"extrapolateErrors",value:function(a){return a}},{key:"createSubmitObject",value:function(a){var b={},c=!0,d=!1,e=void 0;try{for(var f,g,h=a[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)// Radio will only happen once thanks to checking for undefined
if(g=f.value,"undefined"==typeof b[g.name]&&null===g.getAttribute("no-submit"))// Checkboxes are special: they might be handled as native ones,
// (NOTHING set if unchecked, and their value set if checked) or
// as booleans (true for checked, or false for unchecked)
if(!this._checkboxElement(g))b[g.name]=this.getFormElementValue(g.name);else if(this.submitCheckboxesAsNative){// As native checkboxes.
var i=this.getFormElementValue(g.name);i&&(b[g.name]=i)}else// As more app-friendly boolean value
b[g.name]=!!this.getFormElementValue(g.name)}catch(a){d=!0,e=a}finally{try{c||null==h["return"]||h["return"]()}finally{if(d)throw e}}return b}},{key:"presubmit",value:function(){}},{key:"response",value:function(){}},{key:"_disableElements",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,f.disabled||f.setAttribute("disabled",!0)}catch(a){c=!0,d=a}finally{try{b||null==g["return"]||g["return"]()}finally{if(c)throw d}}}},{key:"_enableElements",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f,g=a[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,f.removeAttribute("disabled")}catch(a){c=!0,d=a}finally{try{b||null==g["return"]||g["return"]()}finally{if(c)throw d}}}},{key:"_fetchEl",value:function(a){// Tries to figure out what the fetching element is.
// if fetching-element was passed, then it's either considered an ID
// or the element itself.
// Otherwise it will look for an ee-network or with an element with class
// .network. Finally, it will use `window`
if(a){var b=a;for(var c=!1;b.parentElement;)if(b=b.parentElement,"EE-NETWORK"===b.tagName||b.classList.contains("network")){c=!0;break}return c?b:window}if(this.fetchingElement)return"string"==typeof this.fetchingElement?this.querySelector("#".concat(this.fetchingElement)):this.fetchingElement;var d=this.querySelector("ee-network");return d||(d=this.querySelector(".network")),d||window}},{key:"submit",value:function(){var b=a._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!c){b.next=7;break}if("function"==typeof c.setCustomValidity&&c.setCustomValidity(""),c.reportValidity()){b.next=4;break}return b.abrupt("return");case 4:d=this.createSubmitObject([c]),b.next=29;break;case 7:for(e=!0,f=!1,g=void 0,b.prev=10,h=this.elements[Symbol.iterator]();!(e=(i=h.next()).done);e=!0)j=i.value,"function"==typeof j.setCustomValidity&&j.setCustomValidity("");b.next=18;break;case 14:b.prev=14,b.t0=b["catch"](10),f=!0,g=b.t0;case 18:b.prev=18,b.prev=19,e||null==h["return"]||h["return"]();case 21:if(b.prev=21,!f){b.next=24;break}throw g;case 24:return b.finish(21);case 25:return b.finish(18);case 26:if(this.reportValidity()){b.next=28;break}return b.abrupt("return");case 28:d=this.createSubmitObject(this.elements);case 29:// The connection is ongoing: add a "specificElement" to the attempted
// field, and simply return.
// Towards the end, this function will check that "attempted" which,
// if set, means that the form needs to be resubmitted with that
// specificElement
if(k=c||this,!this.inFlightMap.has(k)){b.next=33;break}return this.inFlightMap.set(k,{attempted:!0}),b.abrupt("return");case 33:if(this.inFlightMap.set(k,{attempted:!1}),l=this.getAttribute("method"),l&&"PUT"!==l.toUpperCase()&&(l="POST"),m=null===l?this.recordId?"PUT":"POST":l,n=this.getAttribute("action"),n){b.next=40;break}throw new Error("The submitted form has no action URL set");case 40:return o=n+(this.recordId?"/".concat(this.recordId):""),p={url:o,method:m,headers:{"Content-Type":"application/json"},redirect:"follow",// manual, *follow, error
body:d// body data type must match "Content-Type" header
},this.presubmit(p),c||this._disableElements(this.elements),p.body=JSON.stringify(p.body),q=!1,b.prev=46,t=this._fetchEl(c),b.next=50,t.fetch(p.url,p);case 50:r=b.sent,b.next=57;break;case 53:b.prev=53,b.t1=b["catch"](46),console.log("ERROR!",b.t1),q=!0;case 57:if(!q){b.next=65;break}console.log("Network error!"),c||this._enableElements(this.elements),u=new CustomEvent("form-error",{detail:{type:"network"},bubbles:!0,composed:!0}),this.dispatchEvent(u),this.response(null,null),b.next=126;break;case 65:if(r.ok){b.next=116;break}return b.next=68,r.json();case 68:// Set error messages
if(w=b.sent,s=this.extrapolateErrors(w)||{},x=new CustomEvent("form-error",{detail:{type:"http",response:r,errs:s},bubbles:!0,composed:!0}),this.dispatchEvent(x),c||this._enableElements(this.elements),!(s.errors&&s.errors.length)){b.next=113;break}for(y={},z=!0,A=!1,B=void 0,b.prev=78,C=this.elements[Symbol.iterator]();!(z=(D=C.next()).done);z=!0)E=D.value,y[E.name]=E;b.next=86;break;case 82:b.prev=82,b.t2=b["catch"](78),A=!0,B=b.t2;case 86:b.prev=86,b.prev=87,z||null==C["return"]||C["return"]();case 89:if(b.prev=89,!A){b.next=92;break}throw B;case 92:return b.finish(89);case 93:return b.finish(86);case 94:for(F=!0,G=!1,H=void 0,b.prev=97,I=s.errors[Symbol.iterator]();!(F=(J=I.next()).done);F=!0)K=J.value,L=y[K.field],L&&(L.setCustomValidity(K.message),L.reportValidity());b.next=105;break;case 101:b.prev=101,b.t3=b["catch"](97),G=!0,H=b.t3;case 105:b.prev=105,b.prev=106,F||null==I["return"]||I["return"]();case 108:if(b.prev=108,!G){b.next=111;break}throw H;case 111:return b.finish(108);case 112:return b.finish(105);case 113:this.response(r,s),b.next=126;break;case 116:return b.next=118,r.json();case 118:M=b.sent,this.inFlightMap.has(k)&&(N=this.inFlightMap.get(k).attempted),this.setFormAfterSubmit&&!N&&(c?(O=k.name,this.setFormElementValues(a._defineProperty({},O,M[O]))):this.setFormElementValues(M)),!this.resetFormAfterSubmit||N||c||this.reset(),c||this._enableElements(this.elements),P=new CustomEvent("form-ok",{detail:{response:r},bubbles:!0,composed:!0}),this.dispatchEvent(P),this.response(r,M);case 126:this.inFlightMap.has(k)&&(Q=this.inFlightMap.get(k).attempted,this.inFlightMap["delete"](k),Q&&this.submit(c));/*
                  this.inFlight = false
                  if (this.attemptedFlight) {
                    const oldEl = this.attemptedFlight
                    this.attemptedFlight = false
                    this.submit(oldEl)
                  }
                  */case 127:case"end":return b.stop();}},b,this,[[10,14,18,26],[19,,21,25],[46,53],[78,82,86,94],[87,,89,93],[97,101,105,113],[106,,108,112]])}));return function(){return b.apply(this,arguments)}}()},{key:"updated",value:function(){var b=a._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function b(d){var e,f,g,h;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:// If no-autoload is set to true, or there is no autoload or no recordId,
// simply give up: nothing to do
if(a._get(a._getPrototypeOf(c.prototype),"updated",this).call(this),!this.noAutoload&&d.has("recordId")){b.next=3;break}return b.abrupt("return");case 3:if("undefined"!=typeof this.recordId&&null!==this.recordId){b.next=5;break}return b.abrupt("return");case 5:if(e=this.getAttribute("action"),!e){b.next=27;break}return b.next=9,this.updateComplete;case 9:return this._disableElements(this.elements),b.prev=10,h=this._fetchEl(),b.next=14,h.fetch(e+"/"+this.recordId);case 14:return f=b.sent,b.next=17,f.json();case 17:g=b.sent,b.next=24;break;case 20:b.prev=20,b.t0=b["catch"](10),console.error("WARNING: Fetching element failed to fetch"),g={};case 24:this.setFormElementValues(g),this._enableElements(this.elements),this.validateOnLoad&&this.reportValidity();case 27:case"end":return b.stop();}},b,this,[[10,20]])}));return function(){return b.apply(this,arguments)}}()},{key:"render",value:function(){return a.html(f(),this.customStyle)}}]),c}(c.ThemeableMixin("en-form")(e.NnForm));customElements.define("en-form",g)});
