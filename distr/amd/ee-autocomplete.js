define(["exports","./lit-element-34339bae","./StyleableMixin-9aebdd05","./ThemeableMixin-c1113bda","./ee-autocomplete-item-li"],function(a,b,c,d){'use strict';function e(){var a=b._taggedTemplateLiteral(["\n      <slot></slot>\n      <div @click=\"","\" id=\"suggestions\" @keydown=","></div>\n    "]);return e=function(){return a},a}function f(){var a=b._taggedTemplateLiteral(["\n        :host {\n          display: block;\n          position: relative;\n        }\n\n        #suggestions {\n          box-sizing: border-box;\n          background-color: white;\n          position: absolute;\n          z-index: 1000;\n          max-height: 480px;\n          overflow-y: scroll;\n          top: 90%;\n          box-shadow: 2px 2px 6px 0 rgba(0, 0, 0, 0.2), 0 0 2px 2px rgba(0, 0, 0, 0.05);\n        }\n\n        #suggestions[populated] {\n          width: 100%;\n          padding: 10px;\n        }\n\n        #suggestions > *[selected], #suggestions > *:focus, #suggestions > *:hover  {\n          background-color: #eee;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      "]);return f=function(){return a},a}var g=/*#__PURE__*/function(a){function c(){var a;return b._classCallCheck(this,c),a=b._possibleConstructorReturn(this,b._getPrototypeOf(c).call(this)),a.url="",a.target=null,a.targetForId=null,a.suggestions=[],a.itemElement="ee-autocomplete-item-li",a.itemElementConfig={},a.itemElementAttributes={},a._boundInputEvent=a._inputEvent.bind(b._assertThisInitialized(a)),a._boundKeydownEvent=a._keydownEvent.bind(b._assertThisInitialized(a)),a}// If if's not set, return the first child
// If it's set:
//   If it's a string, return the #element
//   If it's an object, return it directly (assumption that it's an element)
return b._inherits(c,a),b._createClass(c,null,[{key:"styles",get:function(){return[b._get(b._getPrototypeOf(c),"styles",this)||[],b.css(f())]}},{key:"properties",get:function(){return{url:{type:String},informational:{type:Boolean},target:{type:String},targetForId:{type:String,attribute:"target-for-id"},picked:{type:Boolean,reflect:!0},suggestions:{type:Array,attribute:!1},itemElement:{type:String,attribute:"item-element"},itemElementConfig:{type:Object,attribute:"item-element-config"},itemElementAttributes:{type:Object,attribute:"item-element-attributes"}}}}]),b._createClass(c,[{key:"_findTarget",value:function(a){if(null!==a){if("string"==typeof a)return this.querySelector("#".concat(a));if("object"===b._typeof(a))return a}else return this.children[0];return null}// If if's not set, don't do anything
// If it's set:
//   If it's an empty string, look for the first [name] element without no-submit,
//   If it's a string, return the #element
//   If it's an object, return it  directly (assumption that it's an element)
},{key:"_findTargetForId",value:function(a){if("null"!==a){if("string"==typeof a)return""===a?this.querySelector("[name]:not([no-submit])"):this.querySelector("#".concat(a));if("object"===b._typeof(a))return a}return null}},{key:"connectedCallback",value:function(){return b._get(b._getPrototypeOf(c.prototype),"connectedCallback",this).call(this),this.targetElement=this._findTarget(this.target),this.targetForId=this._findTargetForId(this.targetForId),console.log("Target element:",this.targetElement),console.log("Target for ID element:",this.targetForId),this.targetElement?void(this.targetElement.addEventListener("input",this._boundInputEvent),this.targetElement.addEventListener("keydown",this._boundKeydownEvent),this.targetElement.multiInputApi&&this.targetElement.setPickedElement(this.itemElement,this.itemElementConfig,this.itemElementAttributes)):void console.error("Target element not found")}},{key:"disconnectedCallback",value:function(){this.targetElement&&(this.targetElement.removeEventListener("input",this._boundInputEvent),this.targetElement.removeEventListener("keydown",this._boundKeydownEvent))}},{key:"render",value:function(){return b.html(e(),this._picked,this._handleKeyEvents)}},{key:"_keydownEvent",value:function(a){switch(a.key){case"Escape":this._dismissSuggestions();}}},{key:"pickFirst",value:function(){var a=this.shadowRoot.querySelector("#suggestions");a.querySelector("[selected]").click()}},{key:"focusNext",value:function(){if(this.suggestions.length){var a=this.shadowRoot.querySelector("#suggestions"),b=a.querySelector("[selected]")||a.firstElementChild;1<this.suggestions.length&&(b.toggleAttribute("selected",!1),b=b.nextElementSibling||b.previousElementSibling),b&&b.focus()}}},{key:"_picked",value:function(a){this.informational||!this.targetElement||(this.targetElement.multiInputApi?this.targetElement.pickedElement(a.target.data):(this.targetElement.value=a.target.textValue,this.targetForId&&(this.targetForId.value=a.target.idValue,this.picked=!0)),this._dismissSuggestions(),this.targetElement.focus())}},{key:"updated",value:function(){var a=b._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(c){var d,e,f,g,h,i,j,l,m,n,o,p,q,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c.has("suggestions")){a.next=2;break}return a.abrupt("return");case 2:for(d=this.shadowRoot.querySelector("#suggestions");d.firstChild;)d.removeChild(d.firstChild);if(!this._autocompleteInFlight){a.next=6;break}return a.abrupt("return");case 6:if(!this.targetElement.multiInputApi){a.next=10;break}if(""!==this.targetElement.textInputValue){a.next=10;break}return d.toggleAttribute("populated",!1),a.abrupt("return");case 10:for(e=!0,f=!1,g=void 0,a.prev=13,h=this.suggestions[Symbol.iterator]();!(e=(i=h.next()).done);e=!0){for(j=i.value,l=document.createElement(this.itemElement),l.config=b._objectSpread2({},l.config,{},this.itemElementConfig),(m=0,n=Object.keys(this.itemElementAttributes));m<n.length;m++)o=n[m],l.setAttribute(o,this.itemElementAttributes[o]);l.data=j,l.onkeydown=this._handleKeyEvents.bind(this),l.setAttribute("tabindex",0),d.appendChild(l)}// Only 1 response and it's a plain text input? Autocomplete if text fully matches
// beginning of the only result
a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](13),f=!0,g=a.t0;case 21:a.prev=21,a.prev=22,e||null==h["return"]||h["return"]();case 24:if(a.prev=24,!f){a.next=27;break}throw g;case 27:return a.finish(24);case 28:return a.finish(21);case 29:1!==this.suggestions.length||this.targetElement.multiInputApi||"function"!=typeof this.targetElement.setSelectionRange||(p=d.firstChild,q=p.textValue,q.toUpperCase().startsWith(this.targetElement.value.toUpperCase())&&(r=this.targetElement.value,this.targetElement.value=q,this.targetElement.setSelectionRange(r.length,q.length),this.targetForId&&(this.targetForId.value=p.idValue,this.picked=!0))),this.suggestions.length||d.toggleAttribute("populated",!1),this.suggestions.length&&(d.toggleAttribute("populated",!0),d.firstChild.toggleAttribute("selected",!0));case 32:case"end":return a.stop();}},a,this,[[13,17,21,29],[22,,24,28]])}));return function(){return a.apply(this,arguments)}}()},{key:"_dismissSuggestions",value:function(){var a=this.shadowRoot.querySelector("#suggestions");a.toggleAttribute("populated",!1),this.suggestions=[]}},{key:"_handleKeyEvents",value:function(a){var b=a.currentTarget;if(this.suggestions.length&&b.parentElement)switch(a.key){case"ArrowUp":a.preventDefault(),b.previousElementSibling?b.previousElementSibling.focus():b.parentElement.lastElementChild.focus();break;case"ArrowDown":a.preventDefault(),b.nextElementSibling?b.nextElementSibling.focus():b.parentElement.firstElementChild.focus();break;case"Tab":case"Enter":this._picked(a),a.preventDefault(),this.targetElement.focus();break;case"Escape":this._dismissSuggestions(),this.targetElement.focus();}}},{key:"_inputEvent",value:function(){var a=b._asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=this.targetElement,c){a.next=3;break}return a.abrupt("return");case 3:// If the target element is not valid, don't take off at all
// TAKEN OUT as autocomplete might be necessary to actually make
// it valid
// if (!target.validity.valid) {
//  this.suggestions = []
//  return
// }
// Check if it's inflight. If so, queue up an autocomplete
// with the same 'e'
if(this._dismissSuggestions(),!this._autocompleteInFlight){a.next=7;break}return this._attemptedAutocompleteFlight=b,a.abrupt("return");case 7:return this._autocompleteInFlight=!0,this.targetForId&&(this.targetForId.value="",this.picked=!1),d=c.autocompleteValue||c.value,e=this.url+d,f={method:"GET",redirect:"follow"// manual, *follow, error
},g=!1,a.prev=13,a.next=16,fetch(e,f);case 16:h=a.sent,a.next=23;break;case 19:a.prev=19,a.t0=a["catch"](13),console.log("ERROR!",a.t0),g=!0;case 23:if(!g){a.next=29;break}console.log("Network error!"),i=new CustomEvent("autocomplete-error",{detail:{type:"network"},bubbles:!0,composed:!0}),this.dispatchEvent(i),a.next=44;break;case 29:if(h.ok){a.next=38;break}return console.log("Fetch error!"),a.next=33,h.json();case 33:j=a.sent,k=new CustomEvent("autocomplete-error",{detail:{type:"http",response:h,errs:j},bubbles:!0,composed:!0}),this.dispatchEvent(k),a.next=44;break;case 38:return a.next=40,h.json();case 40:l=a.sent,m=new CustomEvent("form-ok",{detail:{response:h},bubbles:!0,composed:!0}),this.dispatchEvent(m),this.suggestions=l;case 44:this._autocompleteInFlight=!1,this._attemptedAutocompleteFlight&&(n=this._attemptedAutocompleteFlight,this._attemptedAutocompleteFlight=!1,this._inputEvent(n));case 46:case"end":return a.stop();}},a,this,[[13,19]])}));return function(){return a.apply(this,arguments)}}()}]),c}(d.ThemeableMixin("ee-autocomplete")(c.StyleableMixin(b.LitElement)));customElements.define("ee-autocomplete",g),a.EeAutocomplete=g,Object.defineProperty(a,"__esModule",{value:!0})});
