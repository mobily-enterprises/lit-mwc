define(["./lit-element-34339bae","./LabelsMixin-aace811e","./StyleableMixin-9aebdd05","./ThemeableMixin-c1113bda"],function(a,b,c,d){'use strict';function e(){var b=a._taggedTemplateLiteral(["\n        :host {\n          display: inline;\n        }\n        :host(:focus) {\n          outline: none;\n        }\n\n        #list > span {\n          position: relative;\n          display: inline-block;\n        }\n\n        #list > span > *:not(button) {\n          position: relative;\n          display: inline-block;\n          padding: 3px 6px;\n          padding-right: 24px;\n          border: 1px solid #ddd;\n          border-radius: 1em;\n          margin: 2px;\n          vertical-align: middle;\n          line-height: 1em;\n        }\n\n        #list > span > *:not(button)[invalid] {\n          background-color: pink;\n          border-color: red;\n        }\n\n        #list > span:active > *:not(button), #list > span:focus > *:not(button), #list > span:hover > *:not(button) {\n          box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);\n          background-color: #eee;\n          outline: none;\n        }\n        #list > span:active > *:not(button), #list > span:focus > *:not(button) {\n          border-color: var(--nn-primary-color, #ccc);\n        }\n\n        #list > span button.remove {\n          appearance: none;\n          -moz-appearance: none;\n          -webkit-appearance: none;\n          fill: #999;\n          border: none;\n          padding: 0;\n          display: inline-block;\n          position: absolute;\n          top: 55%;\n          right: 4px;\n          transform: translateY(-50%);\n          background: none;\n          z-index:0;\n        }\n\n        #list > *:focus, #list > span *:active {\n          outline: none;\n        }\n\n        #list > span button.remove svg {\n          z-index: -1;\n        }\n\n        #list > span button.remove:hover {\n          fill: #555;\n        }\n\n        input {\n          box-sizing: border-box;\n          display: inline-block;\n          outline: none;\n          vertical-align: middle;\n          height: 1.5em;\n          border: none;\n          font-size: 0.9em;\n          width: 120px;\n        }\n\n        input:focus, input:hover {\n          outline: none\n        }\n\n        span.error-message {\n          color: red;\n        }\n\n        :invalid {\n          background-color: pink;\n          border: var(--nn-input-border-invalid, 1px solid #bb7777);\n        }\n      "]);return e=function(){return b},b}function f(){var b=a._taggedTemplateLiteral(["\n      <span class=\"error-message\">\n        ","\n      </span>\n    "]);return f=function(){return b},b}function g(){var b=a._taggedTemplateLiteral(["\n      ","\n      ","\n      ","\n      <div id=\"list\" @click=\"","\">\n        <input @keydown=\"","\" @input=\"","\" rows=\"1\" id=\"ta\" spellcheck=\"false\" autocomplete=\"false\" autocapitalize=\"off\" autocorrect=\"off\" dir=\"ltr\" role=\"combobox\" aria-autocomplete=\"list\">\n      </div>\n      ","\n      ","\n      <input id=\"ni\" type=\"hidden\" name=\"","\">\n    "]);return g=function(){return b},b}var h=/*#__PURE__*/function(b){function c(){var b;return a._classCallCheck(this,c),b=a._possibleConstructorReturn(this,a._getPrototypeOf(c).call(this)),b.labelForElement="ni",b.valueAs="text",b.removeIcon="<svg class=\"icon\" height=\"15\" viewBox=\"0 0 24 24\" width=\"15\"><path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"></path></svg>",b.itemElement="",b.itemElementConfig={},b.itemElementAttributes={},b.shownValidationMessage="",b.validator=function(){return""},b.validationMessagePosition="before",b.valueSeparator=",",b.validity={valid:!0,_customValidationMessage:""},b}return a._inherits(c,b),a._createClass(c,null,[{key:"properties",get:function(){return{name:{type:String},valueAs:{type:String,attribute:"value-as"},valueSeparator:{type:String,attribute:"value-separator"},validationMessagePosition:{type:String,attribute:"validation-message-position"},shownValidationMessage:{type:String,attribute:!1},validity:{type:Object,attribute:!1},validator:{type:Function}}}}]),a._createClass(c,[{key:"render",value:function(){return a.html(g(),this.customStyle,this.ifLabelBefore,this.ifValidationMessageBefore,this._listClicked,this._handleKeyEvents,this._inputReceived,this.ifValidationMessageAfter,this.ifLabelAfter,this.name)}},{key:"connectedCallback",value:function(){a._get(a._getPrototypeOf(c.prototype),"connectedCallback",this).call(this),this.addEventListener("click",this.focus)}},{key:"disconnectedCallback",value:function(){a._get(a._getPrototypeOf(c.prototype),"connectedCallback",this).call(this),this.removeEventListener("click",this.focus)}},{key:"firstUpdated",value:function(){this._updateNativeInputValue()}},{key:"focus",value:function(){this.shadowRoot.querySelector("#ta").focus()}},{key:"_listClicked",value:function(a){a.stopPropagation()}},{key:"setCustomValidity",value:function(a){""===a?(this.validity={valid:!0,_customValidationMessage:""},this.toggleAttribute("valid",!0),""==a&&(this.shownValidationMessage="")):(this.validity={valid:!1,customError:!0,_customValidationMessage:a},this.toggleAttribute("valid",!1))}},{key:"reportValidity",value:function(){// Run custom validator. Note that custom validator
// will only ever run on filed without an existing customError.
// This is because
if(!this.validity.customError){var a=this.validator();a&&this.setCustomValidity(a)}// Hide the error message by default
return this.shownValidationMessage="",this.validity.valid?(this.toggleAttribute("valid",!0),!0):(this.toggleAttribute("valid",!1),this.shownValidationMessage=this.validity._customValidationMessage,this.dispatchEvent(new CustomEvent("invalid",{cancelable:!0,bubbles:!1,composed:!0})),!1)}},{key:"checkValidity",value:function(){if(!this.native.validity.customError){var a=this.validator();a&&this.setCustomValidity(a)}return!!this.validity.valid||(this.dispatchEvent(new CustomEvent("invalid",{cancelable:!0,bubbles:!1,composed:!0})),!1)}},{key:"_pickCurrentValue",/* END OF CONSTRAINTS API */ // Run this when there are no suggestions and the user hits Tab or Enter in #ta
// This will run pickElement with a STRING, which will get the element to
// work out a data structure based on the string
value:function(){"text"===this.valueAs&&this.pickedElement(this.shadowRoot.querySelector("#ta").value,!0)}},{key:"_askToRemove",value:function(a){var b=a.currentTarget;this._removeItem(b.parentElement.parentElement)}},{key:"_updateNativeInputValue",value:function(){var a=this.shadowRoot.querySelector("#ni");a.value=this.value}},{key:"_removeItem",value:function(a){// Focus previous item before deleting target. If it's the first/only, select the input
var b=a.previousElementSibling||a.nextElementSibling;b.focus(),a.remove(),this._updateNativeInputValue(),this.setCustomValidity(""),this.reportValidity()}},{key:"_createRemoveBtn",value:function(){var a=document.createElement("button");return a.innerHTML=this.removeIcon,a.onclick=this._askToRemove.bind(this),a.classList.add("remove"),a}},{key:"_handleKeyEvents",value:function(a){var b=a.currentTarget;switch(a.key){case"ArrowLeft":b.previousElementSibling&&(a.preventDefault(),b.previousElementSibling.focus());break;case"ArrowRight":"ta"!==b.id&&(a.preventDefault(),b.nextElementSibling?b.nextElementSibling.focus():b.parentElement.firstElementChild.focus());break;case"ArrowDown":this.parentElement.suggestions.length&&(a.preventDefault(),this.parentElement.focusNext());break;case"Backspace":case"Delete":"ta"===b.id&&1<b.parentElement.children.length&&!b.value?this._removeItem(b.previousElementSibling):"ta"!==b.id&&this._removeItem(b);break;case"Tab":case"Enter":if(!this.autocompleteValue)break;this.parentElement.suggestions.length?(a.preventDefault(),this.parentElement.pickFirst()):(a.preventDefault(),this._pickCurrentValue());}}/* API */},{key:"pickedElement",value:function(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],e=document.createElement(this.itemElement),f=new e.constructor.PickedElement;f.config=a._objectSpread2({},f.config,{},this.itemElementConfig);for(var g,h=0,i=Object.keys(this.itemElementAttributes);h<i.length;h++)g=i[h],f.setAttribute(g,this.itemElementAttributes[g]);// Convert string into data if necessary
if("string"==typeof b){if(!b.length)return;if(b=e.stringToData(b),!b.valid&&(f.toggleAttribute("invalid",!0),!c))return}f.data=b;var j=this.shadowRoot.querySelector("#list"),l=document.createElement("span");l.setAttribute("tabindex",-1);var m=this.shadowRoot.querySelector("#ta"),n=this._createRemoveBtn();l.onkeydown=this._handleKeyEvents.bind(this),n.setAttribute("tabindex",-1),l.appendChild(f),f.appendChild(n),j.insertBefore(l,m),m.value="",this._updateNativeInputValue(),d||(this.setCustomValidity(""),this.reportValidity())}},{key:"setPickedElement",value:function(a,b,c){this.itemElement=a,this.itemElementConfig=b,this.itemElementAttributes=c}},{key:"value",get:function(){var a,b;switch(this.valueAs){case"json":a={},b=this.shadowRoot.querySelector("#list");var c=!0,d=!1,e=void 0;try{for(var f,g,h=b.children[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)if(g=f.value,"ta"!==g.id){var i=g.firstChild.idValue;a[i]=g.firstChild.data}}catch(a){d=!0,e=a}finally{try{c||null==h["return"]||h["return"]()}finally{if(d)throw e}}return a;default:a=[],b=this.shadowRoot.querySelector("#list");var j=!0,k=!1,l=void 0;try{for(var m,n,o=b.children[Symbol.iterator]();!(j=(m=o.next()).done);j=!0)n=m.value,"ta"===n.id||("text"===this.valueAs?null===n.getAttribute("invalid")&&a.push(n.firstChild.textValue):a.push(n.firstChild.idValue))}catch(a){k=!0,l=a}finally{try{j||null==o["return"]||o["return"]()}finally{if(k)throw l}}return a.join(this.valueSeparator);}},set:function(b){// Remove all children
for(var c=this.shadowRoot.querySelector("#list");c.firstChild&&"ta"!==c.firstChild.id;)c.removeChild(c.firstChild);// Assign all children using pickedElement
if(Array.isArray(b)){var d=!0,e=!1,f=void 0;try{for(var g,h,i=b[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)h=g.value,this.pickedElement(h,!1,!0)}catch(a){e=!0,f=a}finally{try{d||null==i["return"]||i["return"]()}finally{if(e)throw f}}}else if("object"===a._typeof(b)&&null!==b)for(var j=0,l=Object.keys(b);j<l.length;j++){var m=l[j],k=b[m];this.pickedElement(k,!1,!0)}else if("string"==typeof b){var n=!0,p=!1,q=void 0;try{for(var r,t,u=b.split(this.valueSeparator)[Symbol.iterator]();!(n=(r=u.next()).done);n=!0)t=r.value,this.pickedElement(t,!1,!0)}catch(a){p=!0,q=a}finally{try{n||null==u["return"]||u["return"]()}finally{if(p)throw q}}}// Sets the native input
this._updateNativeInputValue(),this.setCustomValidity(""),this.reportValidity()}},{key:"validationMessage",get:function(){return this.validity._customValidationMessage}},{key:"ifValidationMessageBefore",get:function(){return"after"===this.validationMessagePosition?"":this.validationMessageTemplate}},{key:"ifValidationMessageAfter",get:function(){return"before"===this.validationMessagePosition?"":this.validationMessageTemplate}},{key:"validationMessageTemplate",get:function(){return a.html(f(),this.shownValidationMessage)}},{key:"autocompleteValue",get:function(){var a=this.shadowRoot.querySelector("#ta");return a?a.value:""}},{key:"multiInputApi",get:function(){return!0}},{key:"textInputValue",get:function(){var a=this.shadowRoot.querySelector("#ta");return a?a.value:""}}],[{key:"styles",get:function(){return[a._get(a._getPrototypeOf(c),"styles",this)||[],a.css(e())]}}]),c}(d.ThemeableMixin("ee-autocomplete-input-spans")(b.LabelsMixin(c.StyleableMixin(a.LitElement))));window.customElements.define("ee-autocomplete-input-spans",h)});
