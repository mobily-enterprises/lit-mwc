function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function _templateObject2(){var a=_taggedTemplateLiteral(["\n      <slot></slot>\n      <div @click=\"","\" id=\"suggestions\" @keydown=","></div>\n    "]);return _templateObject2=function(){return a},a}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _templateObject(){var a=_taggedTemplateLiteral(["\n        :host {\n          display: block;\n          position: relative;\n        }\n\n        #suggestions {\n          box-sizing: border-box;\n          background-color: white;\n          position: absolute;\n          z-index: 1000;\n          max-height: 480px;\n          overflow-y: scroll;\n          top: 90%;\n          box-shadow: 2px 2px 6px 0 rgba(0, 0, 0, 0.2), 0 0 2px 2px rgba(0, 0, 0, 0.05);\n        }\n\n        #suggestions[populated] {\n          width: 100%;\n          padding: 10px;\n        }\n\n        #suggestions > *[selected], #suggestions > *:focus, #suggestions > *:hover  {\n          background-color: #eee;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      "]);return _templateObject=function(){return a},a}function _taggedTemplateLiteral(a,b){return b||(b=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}import{L as LitElement,c as css,h as html}from"./lit-element-97ae09cb.js";import{S as StyleableMixin}from"./StyleableMixin-6a125586.js";import{T as ThemeableMixin}from"./ThemeableMixin-af62e1ed.js";import"./ee-autocomplete-item-li.js";var EeAutocomplete=/*#__PURE__*/function(a){function b(){var a;return _classCallCheck(this,b),a=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this)),a.url="",a.target=null,a.targetForId=null,a.suggestions=[],a.itemElement="ee-autocomplete-item-li",a.itemElementConfig={},a.itemElementAttributes={},a._boundInputEvent=a._inputEvent.bind(_assertThisInitialized(a)),a._boundKeydownEvent=a._keydownEvent.bind(_assertThisInitialized(a)),a}// If if's not set, return the first child
// If it's set:
//   If it's a string, return the #element
//   If it's an object, return it directly (assumption that it's an element)
return _inherits(b,a),_createClass(b,null,[{key:"styles",get:function get(){return[_get(_getPrototypeOf(b),"styles",this)||[],css(_templateObject())]}},{key:"properties",get:function get(){return{url:{type:String},informational:{type:Boolean},target:{type:String},targetForId:{type:String,attribute:"target-for-id"},picked:{type:Boolean,reflect:!0},suggestions:{type:Array,attribute:!1},itemElement:{type:String,attribute:"item-element"},itemElementConfig:{type:Object,attribute:"item-element-config"},itemElementAttributes:{type:Object,attribute:"item-element-attributes"}}}}]),_createClass(b,[{key:"_findTarget",value:function _findTarget(a){if(null!==a){if("string"==typeof a)return this.querySelector("#".concat(a));if("object"===_typeof(a))return a}else return this.children[0];return null}// If if's not set, don't do anything
// If it's set:
//   If it's an empty string, look for the first [name] element without no-submit,
//   If it's a string, return the #element
//   If it's an object, return it  directly (assumption that it's an element)
},{key:"_findTargetForId",value:function _findTargetForId(a){if("null"!==a){if("string"==typeof a)return""===a?this.querySelector("[name]:not([no-submit])"):this.querySelector("#".concat(a));if("object"===_typeof(a))return a}return null}},{key:"connectedCallback",value:function connectedCallback(){return _get(_getPrototypeOf(b.prototype),"connectedCallback",this).call(this),this.targetElement=this._findTarget(this.target),this.targetForId=this._findTargetForId(this.targetForId),console.log("Target element:",this.targetElement),console.log("Target for ID element:",this.targetForId),this.targetElement?void(this.targetElement.addEventListener("input",this._boundInputEvent),this.targetElement.addEventListener("keydown",this._boundKeydownEvent),this.targetElement.multiInputApi&&this.targetElement.setPickedElement(this.itemElement,this.itemElementConfig,this.itemElementAttributes)):void console.error("Target element not found")}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.targetElement&&(this.targetElement.removeEventListener("input",this._boundInputEvent),this.targetElement.removeEventListener("keydown",this._boundKeydownEvent))}},{key:"render",value:function render(){return html(_templateObject2(),this._picked,this._handleKeyEvents)}},{key:"_keydownEvent",value:function _keydownEvent(a){switch(a.key){case"Escape":this._dismissSuggestions();}}},{key:"pickFirst",value:function pickFirst(){var a=this.shadowRoot.querySelector("#suggestions");a.querySelector("[selected]").click()}},{key:"focusNext",value:function focusNext(){if(this.suggestions.length){var a=this.shadowRoot.querySelector("#suggestions"),b=a.querySelector("[selected]")||a.firstElementChild;1<this.suggestions.length&&(b.toggleAttribute("selected",!1),b=b.nextElementSibling||b.previousElementSibling),b&&b.focus()}}},{key:"_picked",value:function _picked(a){this.informational||!this.targetElement||(this.targetElement.multiInputApi?this.targetElement.pickedElement(a.target.data):(this.targetElement.value=a.target.textValue,this.targetForId&&(this.targetForId.value=a.target.idValue,this.picked=!0)),this._dismissSuggestions(),this.targetElement.focus())}},{key:"updated",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,l,m,n,o,p,q;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b.has("suggestions")){a.next=2;break}return a.abrupt("return");case 2:for(c=this.shadowRoot.querySelector("#suggestions");c.firstChild;)c.removeChild(c.firstChild);if(!this._autocompleteInFlight){a.next=6;break}return a.abrupt("return");case 6:if(!this.targetElement.multiInputApi){a.next=10;break}if(""!==this.targetElement.textInputValue){a.next=10;break}return c.toggleAttribute("populated",!1),a.abrupt("return");case 10:for(d=!0,e=!1,f=void 0,a.prev=13,g=this.suggestions[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){for(i=h.value,j=document.createElement(this.itemElement),j.config=_objectSpread({},j.config,{},this.itemElementConfig),(l=0,m=Object.keys(this.itemElementAttributes));l<m.length;l++)n=m[l],j.setAttribute(n,this.itemElementAttributes[n]);j.data=i,j.onkeydown=this._handleKeyEvents.bind(this),j.setAttribute("tabindex",0),c.appendChild(j)}// Only 1 response and it's a plain text input? Autocomplete if text fully matches
// beginning of the only result
a.next=21;break;case 17:a.prev=17,a.t0=a["catch"](13),e=!0,f=a.t0;case 21:a.prev=21,a.prev=22,d||null==g["return"]||g["return"]();case 24:if(a.prev=24,!e){a.next=27;break}throw f;case 27:return a.finish(24);case 28:return a.finish(21);case 29:1!==this.suggestions.length||this.targetElement.multiInputApi||"function"!=typeof this.targetElement.setSelectionRange||(o=c.firstChild,p=o.textValue,p.toUpperCase().startsWith(this.targetElement.value.toUpperCase())&&(q=this.targetElement.value,this.targetElement.value=p,this.targetElement.setSelectionRange(q.length,p.length),this.targetForId&&(this.targetForId.value=o.idValue,this.picked=!0))),this.suggestions.length||c.toggleAttribute("populated",!1),this.suggestions.length&&(c.toggleAttribute("populated",!0),c.firstChild.toggleAttribute("selected",!0));case 32:case"end":return a.stop();}},a,this,[[13,17,21,29],[22,,24,28]])}));return function updated(){return a.apply(this,arguments)}}()},{key:"_dismissSuggestions",value:function _dismissSuggestions(){var a=this.shadowRoot.querySelector("#suggestions");a.toggleAttribute("populated",!1),this.suggestions=[]}},{key:"_handleKeyEvents",value:function _handleKeyEvents(a){var b=a.currentTarget;if(this.suggestions.length&&b.parentElement)switch(a.key){case"ArrowUp":a.preventDefault(),b.previousElementSibling?b.previousElementSibling.focus():b.parentElement.lastElementChild.focus();break;case"ArrowDown":a.preventDefault(),b.nextElementSibling?b.nextElementSibling.focus():b.parentElement.firstElementChild.focus();break;case"Tab":case"Enter":this._picked(a),a.preventDefault(),this.targetElement.focus();break;case"Escape":this._dismissSuggestions(),this.targetElement.focus();}}},{key:"_inputEvent",value:function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=this.targetElement,c){a.next=3;break}return a.abrupt("return");case 3:if(this._dismissSuggestions(),!this._autocompleteInFlight){a.next=7;break}return this._attemptedAutocompleteFlight=b,a.abrupt("return");case 7:return this._autocompleteInFlight=!0,this.targetForId&&(this.targetForId.value="",this.picked=!1),d=c.autocompleteValue||c.value,e=this.url+d,f={method:"GET",redirect:"follow"// manual, *follow, error
},g=!1,a.prev=13,a.next=16,fetch(e,f);case 16:h=a.sent,a.next=23;break;case 19:a.prev=19,a.t0=a["catch"](13),console.log("ERROR!",a.t0),g=!0;case 23:if(!g){a.next=29;break}console.log("Network error!"),i=new CustomEvent("autocomplete-error",{detail:{type:"network"},bubbles:!0,composed:!0}),this.dispatchEvent(i),a.next=44;break;case 29:if(h.ok){a.next=38;break}return console.log("Fetch error!"),a.next=33,h.json();case 33:j=a.sent,k=new CustomEvent("autocomplete-error",{detail:{type:"http",response:h,errs:j},bubbles:!0,composed:!0}),this.dispatchEvent(k),a.next=44;break;case 38:return a.next=40,h.json();case 40:l=a.sent,m=new CustomEvent("form-ok",{detail:{response:h},bubbles:!0,composed:!0}),this.dispatchEvent(m),this.suggestions=l;case 44:this._autocompleteInFlight=!1,this._attemptedAutocompleteFlight&&(n=this._attemptedAutocompleteFlight,this._attemptedAutocompleteFlight=!1,this._inputEvent(n));case 46:case"end":return a.stop();}},a,this,[[13,19]])}));return function _inputEvent(){return a.apply(this,arguments)}}()}]),b}(ThemeableMixin("ee-autocomplete")(StyleableMixin(LitElement)));customElements.define("ee-autocomplete",EeAutocomplete);export{EeAutocomplete};