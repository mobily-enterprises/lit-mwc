<!DOCTYPE html>


<html lang="en">
<head>
  <title>en-form.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="../../tpe.css" />


  


</head>
<body>
  <header class="header">
    <div class="topbar">
      <button id="menu-btn">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
      </button>
      <div id="logo" alt="TPE">
      </div>
      <h3 class="page-title">en-form.js</h3>
      <!-- <img id="logo" src="/images/TPE_logo_white.png" height="60px" alt="TPE" > -->
      
        <nav class="header-menu" role="navigation">
          <ul>
            
              
              
                <li>
                    <a class="source " href="../../index.html">
                        home
                    </a>
                </li>
              
            
              
              
                <li>
                    <a class="source " href="../../get-started.html">
                        get started
                    </a>
                </li>
              
            
              
              
                <li>
                    <a class="source " href="../../documentation.html">
                        documentation
                    </a>
                </li>
              
            
              
              
                <li>
                    <a class="source " href="../../codelabs.html">
                        codelabs
                    </a>
                </li>
              
            
              
              
            
              
              
                <li>
                    <a class="source  current " href="../../code.html">
                        code
                    </a>
                </li>
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
              
              
            
          </ul>
        </nav>
      
      <div class="links">
        <a href="https://github.com/mobily-enterprises/tpe" target="_blank" title="View on GitHub">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <title>GitHub icon</title>
            <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
          </svg>
        </a>
      </div>
    </div>
  </header>
  <main role="main">
    
      <nav id="drawer" class="side-menu" role="navigation">
        <ul>
          
            
            
              <li>
                  <a class="source " href="../../index.html">
                      home
                  </a>
              </li>
            
          
            
            
              <li>
                  <a class="source " href="../../get-started.html">
                      get started
                  </a>
              </li>
            
          
            
            
              <li>
                  <a class="source " href="../../documentation.html">
                      documentation
                  </a>
              </li>
            
          
            
            
              <li>
                  <a class="source " href="../../codelabs.html">
                      codelabs
                  </a>
              </li>
            
          
            
            
          
            
            
              <li>
                  <a class="source  current " href="../../code.html">
                      code
                  </a>
              </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </ul>
      </nav>
    
    <section class="content-page">


      
        <nav3 class="header-menu" role="navigation">
          <ul>
            
              
              
              
              
              
              
              
              
              
              
              
              
              
              
                <li>
                  <a class="source  indented " href="../mixins/AddHasValueAttributeMixin.html">
                      code/mixins/AddHasValueAttributeMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/DraggableElementMixin.html">
                      code/mixins/DraggableElementMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/DraggableListMixin.html">
                      code/mixins/DraggableListMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/FormElementMixin.html">
                      code/mixins/FormElementMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/InputMixin.html">
                      code/mixins/InputMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/LabelsMixin.html">
                      code/mixins/LabelsMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/NativeReflectorMixin.html">
                      code/mixins/NativeReflectorMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/NativeValidatorMixin.html">
                      code/mixins/NativeValidatorMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/StyleableMixin.html">
                      code/mixins/StyleableMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/SyntheticValidatorMixin.html">
                      code/mixins/SyntheticValidatorMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="../mixins/ThemeableMixin.html">
                      code/mixins/ThemeableMixin.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="babel.config.html">
                      code/elements/babel.config.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-autocomplete-input-spans.html">
                      code/elements/ee-autocomplete-input-spans.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-autocomplete-item-country.html">
                      code/elements/ee-autocomplete-item-country.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-autocomplete-item-email.html">
                      code/elements/ee-autocomplete-item-email.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-autocomplete-item-li.html">
                      code/elements/ee-autocomplete-item-li.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-autocomplete.html">
                      code/elements/ee-autocomplete.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-cell.html">
                      code/elements/ee-cell.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-drawer.html">
                      code/elements/ee-drawer.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-fab.html">
                      code/elements/ee-fab.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-fade-in.html">
                      code/elements/ee-fade-in.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-header.html">
                      code/elements/ee-header.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-nav-bar.html">
                      code/elements/ee-nav-bar.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-network.html">
                      code/elements/ee-network.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-row.html">
                      code/elements/ee-row.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-snack-bar.html">
                      code/elements/ee-snack-bar.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-table.html">
                      code/elements/ee-table.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-tabs.html">
                      code/elements/ee-tabs.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="ee-toolbar.html">
                      code/elements/ee-toolbar.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented  current " href="en-form.html">
                      code/elements/en-form.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="en-input-range.html">
                      code/elements/en-input-range.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="htmlApi.html">
                      code/elements/htmlApi.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="loader.html">
                      code/elements/loader.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-button.html">
                      code/elements/nn-button.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-form.html">
                      code/elements/nn-form.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-button.html">
                      code/elements/nn-input-button.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-checkbox.html">
                      code/elements/nn-input-checkbox.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-color.html">
                      code/elements/nn-input-color.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-date.html">
                      code/elements/nn-input-date.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-date-time-local.html">
                      code/elements/nn-input-date-time-local.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-email.html">
                      code/elements/nn-input-email.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-file.html">
                      code/elements/nn-input-file.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-month.html">
                      code/elements/nn-input-month.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-number.html">
                      code/elements/nn-input-number.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-password.html">
                      code/elements/nn-input-password.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-radio.html">
                      code/elements/nn-input-radio.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-range.html">
                      code/elements/nn-input-range.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-search.html">
                      code/elements/nn-input-search.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-submit.html">
                      code/elements/nn-input-submit.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-tel.html">
                      code/elements/nn-input-tel.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-text.html">
                      code/elements/nn-input-text.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-time.html">
                      code/elements/nn-input-time.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-url.html">
                      code/elements/nn-input-url.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-input-week.html">
                      code/elements/nn-input-week.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-meter.html">
                      code/elements/nn-meter.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-progress.html">
                      code/elements/nn-progress.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-select.html">
                      code/elements/nn-select.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="nn-textarea.html">
                      code/elements/nn-textarea.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="rollup.config.html">
                      code/elements/rollup.config.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="tpe-babel.html">
                      code/elements/tpe-babel.js
                  </a>
                </li>
            
              
              
                <li>
                  <a class="source  indented " href="tpe.html">
                      code/elements/tpe.js
                  </a>
                </li>
            
          </ul>
        </nav3>
      

      
      <article>
        
          
          
          
            <div class='highlight'><pre><span class="hljs-keyword">import</span> { html } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lit-element&#x27;</span>
<span class="hljs-keyword">import</span> { NnForm } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./nn-form.js&#x27;</span>
<span class="hljs-keyword">import</span> { ThemeableMixin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./mixins/ThemeableMixin&#x27;</span>

<span class="hljs-comment">/* globals customElements CustomEvent */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnForm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ThemeableMixin</span>(&#x27;<span class="hljs-title">en</span>-<span class="hljs-title">form</span>&#x27;)(<span class="hljs-title">NnForm</span>) </span>{
  get skipProperties () {
    <span class="hljs-keyword">return</span> [...super.skipProperties, <span class="hljs-string">&#x27;submit&#x27;</span>]
  }

  <span class="hljs-keyword">static</span> get properties () {
    <span class="hljs-keyword">return</span> {

      <span class="hljs-attr">fetchingElement</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;fetching-element&#x27;</span>
      },

      <span class="hljs-attr">recordId</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;record-id&#x27;</span>
      },

      <span class="hljs-attr">setFormAfterSubmit</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;set-form-after-submit&#x27;</span>
      },

      <span class="hljs-attr">resetFormAfterSubmit</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;reset-form-after-submit&#x27;</span>
      },

      <span class="hljs-attr">validateOnLoad</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;validate-on-load&#x27;</span>
      },

      <span class="hljs-attr">validateOnRender</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;validate-on-render&#x27;</span>
      },

      <span class="hljs-attr">submitCheckboxesAsNative</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;submit-checkboxes-as-native&#x27;</span>

      },
      <span class="hljs-attr">noAutoload</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>,
        <span class="hljs-attr">attribute</span>: <span class="hljs-string">&#x27;no-autoload&#x27;</span>
      },</pre></div>
          
        
          
          <p>This will allow users to redefine methods declaratively</p>

          
            <div class='highlight'><pre>      presubmit: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Function</span>, <span class="hljs-attr">attribute</span>: <span class="hljs-literal">false</span> },
      <span class="hljs-attr">response</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Function</span>, <span class="hljs-attr">attribute</span>: <span class="hljs-literal">false</span> },
      <span class="hljs-attr">incomingData</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Function</span>, <span class="hljs-attr">attribute</span>: <span class="hljs-literal">false</span> },
      <span class="hljs-attr">dataLoaded</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Function</span>, <span class="hljs-attr">attribute</span>: <span class="hljs-literal">false</span> },
      <span class="hljs-attr">extrapolateErrors</span>: { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Function</span>, <span class="hljs-attr">attribute</span>: <span class="hljs-literal">false</span> }

    }
  }

  <span class="hljs-title">constructor</span> (<span class="hljs-params"></span>) {
    <span class="hljs-built_in">super</span>()
    <span class="hljs-built_in">this</span>.validateOnLoad = <span class="hljs-literal">false</span>
    <span class="hljs-built_in">this</span>.validateOnRender = <span class="hljs-literal">false</span>
    <span class="hljs-built_in">this</span>.fetchingElement = <span class="hljs-literal">null</span>
    <span class="hljs-built_in">this</span>.submitCheckboxesAsNative = <span class="hljs-literal">false</span>
    <span class="hljs-built_in">this</span>._boundRealtimeSubmitter = <span class="hljs-built_in">this</span>._realTimeSubmitter.bind(<span class="hljs-built_in">this</span>)
    <span class="hljs-built_in">this</span>.attemptedFlight = <span class="hljs-literal">false</span>
    <span class="hljs-built_in">this</span>.inFlightMap = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()
    <span class="hljs-built_in">this</span>.attemptedFlightMap = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()
    <span class="hljs-built_in">this</span>.submitObject = {}
  }

  <span class="hljs-keyword">async</span> _allChildrenCompleted () {</pre></div>
          
        
          
          <p>Wait for all children to be ready to rock and roll</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.elements) {</pre></div>
          
        
          
          <p>TODO: What about React, Vue, etc.? Uniform API across element libraries?</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> el.updateComplete !== <span class="hljs-string">&#x27;undefined&#x27;</span>) {
        <span class="hljs-keyword">await</span> el.updateComplete
      }
    }
  }

  _realTimeSubmitter (e) {
    <span class="hljs-built_in">this</span>.submit(e.target)
  }

  connectedCallback () {
    <span class="hljs-built_in">super</span>.connectedCallback()
    <span class="hljs-built_in">this</span>._allChildrenCompleted().then(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.elements) {
        <span class="hljs-keyword">const</span> realTime = el.getAttribute(<span class="hljs-string">&#x27;real-time&#x27;</span>) !== <span class="hljs-literal">null</span>
        <span class="hljs-keyword">const</span> realTimeEvent = el.getAttribute(<span class="hljs-string">&#x27;real-time-event&#x27;</span>) || <span class="hljs-string">&#x27;input&#x27;</span>
        <span class="hljs-keyword">if</span> (!realTime || !realTimeEvent) <span class="hljs-keyword">continue</span>
        el.addEventListener(realTimeEvent, <span class="hljs-built_in">this</span>._boundRealtimeSubmitter)
      }
    })
  }

  disconnectedCallback () {
    <span class="hljs-built_in">super</span>.disconnectedCallback()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.elements) {
      <span class="hljs-keyword">const</span> realTime = el.getAttribute(<span class="hljs-string">&#x27;real-time&#x27;</span>)
      <span class="hljs-keyword">if</span> (realTime === <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">const</span> realTimeEvent = el.getAttribute(<span class="hljs-string">&#x27;real-time-event&#x27;</span>)
      <span class="hljs-keyword">if</span> (!realTimeEvent) <span class="hljs-keyword">continue</span>

      el.removeEventListener(realTimeEvent, <span class="hljs-built_in">this</span>._boundRealtimeSubmitter)
    }
  }

  <span class="hljs-keyword">async</span> firstUpdated () {
    <span class="hljs-built_in">super</span>.firstUpdated()

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.validateOnRender) {
      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>._allChildrenCompleted()</pre></div>
          
        
          
          <p>Check validity</p>

          
            <div class='highlight'><pre>      <span class="hljs-built_in">this</span>.reportValidity()
    }
  }

  setFormElementValues (o) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> k <span class="hljs-keyword">in</span> o) {
      <span class="hljs-built_in">this</span>.setFormElementValue(k, o[k], <span class="hljs-literal">true</span>)
    }
  }

  setRecordObject (o) {
    o = { ...o }
    <span class="hljs-keyword">const</span> elHash = {}
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.elements) elHash[el.getAttribute(<span class="hljs-string">&#x27;name&#x27;</span>)] = el

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> k <span class="hljs-keyword">of</span> <span class="hljs-built_in">Object</span>.keys(elHash)) {
      o[k] = <span class="hljs-built_in">this</span>.getFormElementValue(k)
    }
    <span class="hljs-keyword">return</span> o
  }

  extrapolateErrors (o) {
    <span class="hljs-keyword">return</span> o
  }

  <span class="hljs-keyword">async</span> presubmit (fetchOptions) {}

  <span class="hljs-keyword">async</span> response (response, errs, fetchOptions) {} <span class="hljs-comment">// If (response !== null and response.ok), it worked</span>

  <span class="hljs-keyword">async</span> incomingData (o, op) {} <span class="hljs-comment">// op can be &#x27;autoload&#x27; or &#x27;submit&#x27;</span>

  <span class="hljs-keyword">async</span> dataLoaded (o, op) {} <span class="hljs-comment">// op can be &#x27;autoload&#x27; or &#x27;submit&#x27;</span></pre></div>
          
        
          
          <p>Disabled here is set (and checked) with both the attribute and the property
‘disabled’ since an element might be disabled in the html, but might
not have had a chance to render yet (in which case, for non-native elemtns,
it would mean that the property is not yet there, since the reflector hasn’t
yet run)</p>

          
            <div class='highlight'><pre>  _disableElements (elements) {
    <span class="hljs-built_in">this</span>.__disabled = <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> elements) {
      <span class="hljs-keyword">if</span> (!el.disabled &amp;&amp; !el.hasAttribute(<span class="hljs-string">&#x27;disabled&#x27;</span>)) {
        el.setAttribute(<span class="hljs-string">&#x27;disabled&#x27;</span>, <span class="hljs-literal">true</span>)
        el.disabled = <span class="hljs-literal">true</span>
        <span class="hljs-built_in">this</span>.__disabled.set(el, <span class="hljs-literal">true</span>)
      }
    }
  }

  _enableElements (elements) {
    <span class="hljs-built_in">this</span>.__disabled = <span class="hljs-built_in">this</span>.__disabled || <span class="hljs-keyword">new</span> <span class="hljs-built_in">WeakMap</span>()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> elements) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.__disabled.has(el)) {
        el.removeAttribute(<span class="hljs-string">&#x27;disabled&#x27;</span>)
        el.disabled = <span class="hljs-literal">false</span>
        <span class="hljs-built_in">this</span>.__disabled.delete(el)
      }
    }
  }

  _fetchEl (specificElement) {</pre></div>
          
        
          
          <p>Tries to figure out what the fetching element is.
if fetching-element was passed, then it’s either considered an ID
or the element itself.
Otherwise it will look for an ee-network or with an element with class
.network. Finally, it will use <code>window</code></p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (specificElement) {
      <span class="hljs-keyword">let</span> pEl
      pEl = specificElement
      <span class="hljs-keyword">let</span> found = <span class="hljs-literal">false</span>
      <span class="hljs-keyword">while</span> (pEl.parentElement) {
        pEl = pEl.parentElement
        <span class="hljs-keyword">if</span> (pEl.tagName === <span class="hljs-string">&#x27;EE-NETWORK&#x27;</span> || pEl.classList.contains(<span class="hljs-string">&#x27;network&#x27;</span>)) {
          found = <span class="hljs-literal">true</span>
          <span class="hljs-keyword">break</span>
        }
      }
      <span class="hljs-keyword">return</span> found ? pEl : <span class="hljs-built_in">window</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.fetchingElement) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">this</span>.fetchingElement === <span class="hljs-string">&#x27;string&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.querySelector(<span class="hljs-string">`#<span class="hljs-subst">${<span class="hljs-built_in">this</span>.fetchingElement}</span>`</span>)
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.fetchingElement
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> maybeNetwork = <span class="hljs-built_in">this</span>.querySelector(<span class="hljs-string">&#x27;ee-network&#x27;</span>)
        <span class="hljs-keyword">if</span> (!maybeNetwork) maybeNetwork = <span class="hljs-built_in">this</span>.querySelector(<span class="hljs-string">&#x27;.network&#x27;</span>)
        <span class="hljs-keyword">return</span> maybeNetwork || <span class="hljs-built_in">window</span>
      }
    }
  }

  <span class="hljs-keyword">async</span> _wait (ms) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(resolve, ms)
    })
  }

  <span class="hljs-keyword">async</span> submit (specificElement) {</pre></div>
          
        
          
          <p>Clear all custom validities if they are set
Native elements will NEED this, or any invalid state
will persist even if validation passes
Then, make up submit object and check whether reportValidity returns
false (which basically means “abort”)</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (specificElement) {
      <span class="hljs-built_in">this</span>.clearAllCustomValidity([specificElement])
      <span class="hljs-built_in">this</span>.submitObject = <span class="hljs-built_in">this</span>.createSubmitObject([specificElement])
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> specificElement.reportValidity === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; !specificElement.reportValidity()) <span class="hljs-keyword">return</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">this</span>.clearAllCustomValidity(<span class="hljs-built_in">this</span>.elements)
      <span class="hljs-built_in">this</span>.submitObject = <span class="hljs-built_in">this</span>.createSubmitObject(<span class="hljs-built_in">this</span>.elements)
      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.reportValidity()) <span class="hljs-keyword">return</span>
    }</pre></div>
          
        
          
          <p>Give users the ability to listen to @submit and then Allow for a presubmit hook</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">const</span> submitEvent = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&#x27;submit&#x27;</span>, { <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">composed</span>: <span class="hljs-literal">true</span> })
    <span class="hljs-built_in">this</span>.dispatchEvent(submitEvent)
    <span class="hljs-keyword">if</span> (submitEvent.defaultPrevented) <span class="hljs-keyword">return</span></pre></div>
          
        
          
          <p>inFlightMap is a map of all connections, using the specificElement
as key (or “window” if there is no specific element)</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">const</span> mapIndex = specificElement || <span class="hljs-built_in">this</span></pre></div>
          
        
          
          <p>The connection is ongoing: add a “specificElement” to the attempted
field, and simply return.
Towards the end, this function will check that “attempted” which,
if set, means that the form needs to be resubmitted with that
specificElement</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.inFlightMap.has(mapIndex)) {
      <span class="hljs-built_in">this</span>.inFlightMap.set(mapIndex, { <span class="hljs-attr">attempted</span>: <span class="hljs-literal">true</span> })
      <span class="hljs-keyword">return</span>
    }
    <span class="hljs-built_in">this</span>.inFlightMap.set(mapIndex, { <span class="hljs-attr">attempted</span>: <span class="hljs-literal">false</span> })</pre></div>
          
        
          
          <p>The element’s method can only be null, POST or PUT.
If not null, and not “PUT”, it’s set to “POST”</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">let</span> elementMethod = <span class="hljs-built_in">this</span>.getAttribute(<span class="hljs-string">&#x27;method&#x27;</span>)
    <span class="hljs-keyword">if</span> (elementMethod &amp;&amp; elementMethod.toUpperCase() !== <span class="hljs-string">&#x27;PUT&#x27;</span>) {
      elementMethod = <span class="hljs-string">&#x27;POST&#x27;</span>
    }</pre></div>
          
        
          
          <p>The ‘method’ attribute will have priority no matter what.
If <code>method</code> is not set, then it will depend on recordId (PUT if present,
POST if not)</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">const</span> method = elementMethod === <span class="hljs-literal">null</span>
      ? <span class="hljs-built_in">this</span>.recordId ? <span class="hljs-string">&#x27;PUT&#x27;</span> : <span class="hljs-string">&#x27;POST&#x27;</span>
      : elementMethod</pre></div>
          
        
          
          <p>Set the url, which will also depend on recordId</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">const</span> action = <span class="hljs-built_in">this</span>.getAttribute(<span class="hljs-string">&#x27;action&#x27;</span>)
    <span class="hljs-keyword">if</span> (!action) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;The submitted form has no action URL set&#x27;</span>)
    <span class="hljs-keyword">const</span> url = action + (<span class="hljs-built_in">this</span>.recordId ? <span class="hljs-string">`/<span class="hljs-subst">${<span class="hljs-built_in">this</span>.recordId}</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>)

    <span class="hljs-keyword">const</span> fetchOptions = {
      url,
      method,
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-built_in">this</span>.getAttribute(<span class="hljs-string">&#x27;enctype&#x27;</span>) || <span class="hljs-string">&#x27;application/json&#x27;</span> },
      <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;follow&#x27;</span>, <span class="hljs-comment">// manual, *follow, error</span>
      <span class="hljs-attr">body</span>: <span class="hljs-built_in">this</span>.submitObject <span class="hljs-comment">// body data type must match &quot;Content-Type&quot; header</span>
    }</pre></div>
          
        
          
          <p>HOOK: Allow devs to customise the request about to be sent to the server</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.presubmit(fetchOptions)</pre></div>
          
        
          
          <p>Disable the elements</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!specificElement) <span class="hljs-built_in">this</span>._disableElements(<span class="hljs-built_in">this</span>.elements)</pre></div>
          
        
          
          <p>Delete the multipart/form-data header if it was set, since
the browser will set it (with the right boundary parameter)
<a href="https://muffinman.io/uploading-files-using-fetch-multipart-form-data/">https://muffinman.io/uploading-files-using-fetch-multipart-form-data/</a>
<a href="https://stackoverflow.com/questions/35192841/fetch-post-with-multipart-form-data">https://stackoverflow.com/questions/35192841/fetch-post-with-multipart-form-data</a></p>
<p>ALSO turn body into a FormData object, with all values appended.
Note that for files. createSubmitObject will assign the element itself
as the value.</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (fetchOptions.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] === <span class="hljs-string">&#x27;multipart/form-data&#x27;</span>) {
      <span class="hljs-keyword">delete</span> fetchOptions.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>]

      <span class="hljs-keyword">const</span> body = fetchOptions.body
      <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> FormData()

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> k <span class="hljs-keyword">in</span> body) {
        <span class="hljs-keyword">if</span> (body[k] <span class="hljs-keyword">instanceof</span> HTMLElement) {
          <span class="hljs-keyword">const</span> filesInEl = body[k].files
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> f <span class="hljs-keyword">of</span> filesInEl) formData.append(k, f)
        } <span class="hljs-keyword">else</span> {
          formData.append(k, body[k])
        }
      }
      fetchOptions.body = formData
    }</pre></div>
          
        
          
          <p>Attempt the submission</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">let</span> networkError = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">let</span> response
    <span class="hljs-keyword">let</span> errs
    <span class="hljs-keyword">const</span> body =
      fetchOptions.headers[<span class="hljs-string">&#x27;Content-Type&#x27;</span>] === <span class="hljs-string">&#x27;application/json&#x27;</span> &amp;&amp;
      <span class="hljs-keyword">typeof</span> fetchOptions.body === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp;
      fetchOptions.body !== <span class="hljs-literal">null</span>
        ? <span class="hljs-built_in">JSON</span>.stringify(fetchOptions.body)
        : fetchOptions.body
    <span class="hljs-keyword">try</span> {</pre></div>
          
        
          
          <p>fetch() wants a stingified body</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">const</span> fo = { ...fetchOptions, ...{ <span class="hljs-attr">body</span>: body } }
      <span class="hljs-keyword">const</span> el = <span class="hljs-built_in">this</span>._fetchEl(specificElement)
      response = <span class="hljs-keyword">await</span> el.fetch(fetchOptions.url, fo)
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;ERROR!&#x27;</span>, e)
      networkError = <span class="hljs-literal">true</span>
    }</pre></div>
          
        
          
          <p>CASE #1: network error.</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (networkError) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Network error!&#x27;</span>)</pre></div>
          
        
          
          <p>Re-enable the elements</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!specificElement) {
        <span class="hljs-built_in">this</span>._enableElements(<span class="hljs-built_in">this</span>.elements)
        <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>._wait(<span class="hljs-number">0</span>)
      }</pre></div>
          
        
          
          <p>Emit event to make it possible to tell the user via UI about the problem</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&#x27;form-error&#x27;</span>, { <span class="hljs-attr">detail</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;network&#x27;</span> }, <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">composed</span>: <span class="hljs-literal">true</span> })
      <span class="hljs-built_in">this</span>.dispatchEvent(event)</pre></div>
          
        
          
          <p>Response hook</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.response(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, fetchOptions)</pre></div>
          
        
          
          <p>CASE #2: HTTP error.
Invalidate the problem fields</p>

          
            <div class='highlight'><pre>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!response.ok) {</pre></div>
          
        
          
          <p>Try and get the errors object from the reponse’s json</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">let</span> originalErrs
      <span class="hljs-keyword">try</span> {
        originalErrs = <span class="hljs-keyword">await</span> response.json()
      } <span class="hljs-keyword">catch</span> (e) {
        originalErrs = {}
      }
      errs = <span class="hljs-built_in">this</span>.extrapolateErrors(originalErrs) || {}</pre></div>
          
        
          
          <p>Emit event to make it possible to tell the user via UI about the problem</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&#x27;form-error&#x27;</span>, { <span class="hljs-attr">detail</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;http&#x27;</span>, response, errs }, <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">composed</span>: <span class="hljs-literal">true</span> })
      <span class="hljs-built_in">this</span>.dispatchEvent(event)</pre></div>
          
        
          
          <p>Re-enable the elements
This must happen before setCustomValidity() and reportValidity()</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!specificElement) {
        <span class="hljs-built_in">this</span>._enableElements(<span class="hljs-built_in">this</span>.elements)
        <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>._wait(<span class="hljs-number">0</span>)
      }</pre></div>
          
        
          
          <p>Set error messages</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (errs.errors &amp;&amp; errs.errors.length) {
        <span class="hljs-keyword">const</span> elHash = {}
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> el <span class="hljs-keyword">of</span> <span class="hljs-built_in">this</span>.elements) {
          elHash[el.getAttribute(<span class="hljs-string">&#x27;name&#x27;</span>)] = el
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> err <span class="hljs-keyword">of</span> errs.errors) {
          <span class="hljs-keyword">const</span> el = elHash[err.field]
          <span class="hljs-keyword">if</span> (el &amp;&amp; el.setCustomValidity) {
            el.setCustomValidity(err.message)
            el.reportValidity()
          }
        }
      }</pre></div>
          
        
          
          <p>Response hook</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.response(response, errs, fetchOptions)</pre></div>
          
        
          
          <p>CASE #3: NO error. Set fields to their
new values</p>

          
            <div class='highlight'><pre>    } <span class="hljs-keyword">else</span> {</pre></div>
          
        
          
          <p>Convert the result to JSON</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">const</span> v = <span class="hljs-keyword">await</span> response.json()

      <span class="hljs-keyword">let</span> attempted
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.inFlightMap.has(mapIndex)) {
        attempted = <span class="hljs-built_in">this</span>.inFlightMap.get(mapIndex).attempted
      }

      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.incomingData(v, <span class="hljs-string">&#x27;submit&#x27;</span>)</pre></div>
          
        
          
          <p>HOOK Set the form values, in case the server processed some values
Note: this is only ever called if set-form-after-submit was
passed to the form.</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.setFormAfterSubmit) {</pre></div>
          
        
          
          <p>Won’t overwrite fields if another attempt is queued</p>

          
            <div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!attempted) {
          <span class="hljs-keyword">if</span> (!specificElement) {
            <span class="hljs-built_in">this</span>.setFormElementValues(v)
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> name = mapIndex.name
            <span class="hljs-built_in">this</span>.setFormElementValues({ [name]: v[name] })
          }
        }
      }</pre></div>
          
        
          
          <p>Re-enable the elements</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!specificElement) {
        <span class="hljs-built_in">this</span>._enableElements(<span class="hljs-built_in">this</span>.elements)
        <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>._wait(<span class="hljs-number">0</span>)
      }</pre></div>
          
        
          
          <p>Maybe reset the form if it was so required</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.resetFormAfterSubmit &amp;&amp; !attempted &amp;&amp; !specificElement) <span class="hljs-built_in">this</span>.reset()

      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.dataLoaded(v, <span class="hljs-string">&#x27;submit&#x27;</span>)</pre></div>
          
        
          
          <p>Emit event to make it possible to tell the user via UI about the problem</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&#x27;form-ok&#x27;</span>, { <span class="hljs-attr">detail</span>: { response }, <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">composed</span>: <span class="hljs-literal">true</span> })
      <span class="hljs-built_in">this</span>.dispatchEvent(event)</pre></div>
          
        
          
          <p>Response hook</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.response(response, v, fetchOptions)
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.inFlightMap.has(mapIndex)) {
      <span class="hljs-keyword">const</span> attempted = <span class="hljs-built_in">this</span>.inFlightMap.get(mapIndex).attempted
      <span class="hljs-built_in">this</span>.inFlightMap.delete(mapIndex)
      <span class="hljs-keyword">if</span> (attempted) {
        <span class="hljs-built_in">this</span>.submit(specificElement)
      }
    }
  }

  <span class="hljs-keyword">async</span> updated (changedProperties) {</pre></div>
          
        
          
          <p>The ‘await’ here has the side effect of waiting for the next tick,
which means that children elements will have a chance to render</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">await</span> <span class="hljs-built_in">super</span>.updated()</pre></div>
          
        
          
          <p>If no-autoload is set to true, or there is no autoload or no recordId,
simply give up: nothing to do</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.noAutoload || !changedProperties.has(<span class="hljs-string">&#x27;recordId&#x27;</span>)) <span class="hljs-keyword">return</span></pre></div>
          
        
          
          <p>Record ID must be “something”</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">this</span>.recordId === <span class="hljs-string">&#x27;undefined&#x27;</span> || <span class="hljs-built_in">this</span>.recordId === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.preloadData()
  }

  <span class="hljs-keyword">async</span> preloadData () {</pre></div>
          
        
          
          <p>Work out the action’s URL, adding the record ID  at the end
(It will be a get)
If there is a result, fetch the element values</p>

          
            <div class='highlight'><pre>    <span class="hljs-keyword">const</span> action = <span class="hljs-built_in">this</span>.getAttribute(<span class="hljs-string">&#x27;action&#x27;</span>)
    <span class="hljs-keyword">let</span> response
    <span class="hljs-keyword">if</span> (action) {</pre></div>
          
        
          
          <p>This will make sure that the element is actually visible
before doing the fetch</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.updateComplete</pre></div>
          
        
          
          <p>Disable elements</p>

          
            <div class='highlight'><pre>      <span class="hljs-built_in">this</span>._disableElements(<span class="hljs-built_in">this</span>.elements)</pre></div>
          
        
          
          <p>Fetch the data and trasform it to json</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">let</span> v
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> el = <span class="hljs-built_in">this</span>._fetchEl()
        response = <span class="hljs-keyword">await</span> el.fetch(action + <span class="hljs-string">&#x27;/&#x27;</span> + <span class="hljs-built_in">this</span>.recordId)
        v = <span class="hljs-keyword">await</span> response.json()
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&#x27;WARNING: Fetching element failed to fetch&#x27;</span>)
        v = {}
      }

      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.incomingData(v, <span class="hljs-string">&#x27;autoload&#x27;</span>)</pre></div>
          
        
          
          <p>Set values</p>

          
            <div class='highlight'><pre>      <span class="hljs-built_in">this</span>.setFormElementValues(v)</pre></div>
          
        
          
          <p>Re-enabled all disabled fields</p>

          
            <div class='highlight'><pre>      <span class="hljs-built_in">this</span>._enableElements(<span class="hljs-built_in">this</span>.elements)
      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>._wait(<span class="hljs-number">0</span>)</pre></div>
          
        
          
          <p>Run reportValidity if validateOnLoad is on</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.validateOnLoad) {
        <span class="hljs-built_in">this</span>.reportValidity()
      }</pre></div>
          
        
          
          <p>Run hook</p>

          
            <div class='highlight'><pre>      <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.dataLoaded(v, <span class="hljs-string">&#x27;autoload&#x27;</span>)
    }
  }

  render () {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.themeRender) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.themeRender()
    <span class="hljs-keyword">return</span> html`<span class="xml">
      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;native&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    `</span>
  }
}
customElements.define(<span class="hljs-string">&#x27;en-form&#x27;</span>, EnForm)</pre></div>
          
        
      </article>

        
    </section>
  </main>
  <footer></footer>
</body>
<script>
  const menuBtn = document.getElementById('menu-btn')
  const drawer = document.getElementById('drawer')
  menuBtn.addEventListener('click', () => {
    requestAnimationFrame(() => {
      drawer.toggleAttribute('open')
    })
  })
</script>




</html>
